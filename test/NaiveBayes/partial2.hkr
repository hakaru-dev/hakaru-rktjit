((fn
   topic_prior
   ((array prob)
    ->
    ((array nat) -> ((array nat) -> ((array nat) -> (nat -> (array prob))))))
   ((fn
     word_prior
     ((array nat) -> ((array nat) -> ((array nat) -> (nat -> (array prob)))))
     ((fn
       z
       ((array nat) -> ((array nat) -> (nat -> (array prob))))
       ((fn
         w
         ((array nat) -> (nat -> (array prob)))
         ((fn
           doc
           (nat -> (array prob))
           ((fn
             docUpdate
             (array prob)
             ((array
               (zNewf ((size (topic_prior : (array prob))) : nat))
               ((real2prob
                 ((*
                   ((+
                     ((int2real
                       ((let (summary
                              (array nat)
                              ((bucket
                                ((nat_ 0) : nat)
                                ((size (z : (array nat))) : nat)
                                (r_index
                                 ((size (topic_prior : (array prob)))
                                  :
                                  nat)
                                 (bind
                                  iF
                                  ((index (z : (array nat)) (iF : nat))
                                   :
                                   nat))
                                 (r_add
                                  (bind
                                   iF
                                   (bind zNewf ((nat_ 1) : nat))))))
                               :
                               (array nat)))
                          ((+
                            ((*
                              ((nat2int
                                ((match
                                     ((and ((not
                                             ((<
                                               ((+
                                                 ((nat2int
                                                   ((size
                                                     (topic_prior
                                                      :
                                                      (array prob)))
                                                    :
                                                    nat))
                                                  :
                                                  int)
                                                 ((int_ -1) : int))
                                                :
                                                int)
                                               ((nat2int
                                                 ((index
                                                   (z : (array nat))
                                                   (docUpdate : nat))
                                                  :
                                                  nat))
                                                :
                                                int))
                                              :
                                              bool))
                                            :
                                            bool)
                                           ((==
                                             (zNewf : nat)
                                             ((index
                                               (z : (array nat))
                                               (docUpdate : nat))
                                              :
                                              nat))
                                            :
                                            bool))
                                      :
                                      bool)
                                   ((pdatum true (pc_inl (ps_done)))
                                    ((nat_ 1) : nat))
                                   ((pdatum
                                     false
                                     (pc_inr (pc_inl (ps_done))))
                                    ((nat_ 0) : nat)))
                                 :
                                 nat))
                               :
                               int)
                              ((int_ -1) : int))
                             :
                             int)
                            ((nat2int
                              ((index
                                (summary : (array nat))
                                (zNewf : nat))
                               :
                               nat))
                             :
                             int))
                           :
                           int))
                        :
                        int))
                      :
                      real)
                     ((prob2real
                       ((index
                         (topic_prior : (array prob))
                         (zNewf : nat))
                        :
                        prob))
                      :
                      real))
                    :
                    real)
                   ((prob2real
                     ((recip
                       ((product
                         (i
                          ((nat_ 0) : nat)
                          ((size (topic_prior : (array prob))) : nat))
                         ((product
                           (iB
                            ((nat_ 0) : nat)
                            ((let (summary
                                   (pair (array nat) unit)
                                   ((bucket
                                     ((nat_ 0) : nat)
                                     ((size (w : (array nat))) : nat)
                                     (r_fanout
                                      (r_index
                                       ((size (z : (array nat))) : nat)
                                       (bind
                                        iF
                                        ((index
                                          (doc : (array nat))
                                          (iF : nat))
                                         :
                                         nat))
                                       (r_add
                                        (bind
                                         iF
                                         (bind
                                          docUpdate
                                          ((nat_ 1) : nat)))))
                                      r_nop))
                                    :
                                    (pair (array nat) unit)))
                               ((match
                                    ((== (i : nat) (zNewf : nat)) : bool)
                                  ((pdatum true (pc_inl (ps_done)))
                                   ((index
                                     ((match
                                          (summary
                                           :
                                           (pair (array nat) unit))
                                        ((pdatum
                                          pair
                                          (pc_inl
                                           (ps_et
                                            (pf_konst var)
                                            (ps_et
                                             (pf_konst var)
                                             (ps_done)))))
                                         (bind y (bind z y))))
                                      :
                                      (array nat))
                                     (docUpdate : nat))
                                    :
                                    nat))
                                  ((pdatum
                                    false
                                    (pc_inr (pc_inl (ps_done))))
                                   ((nat_ 0) : nat)))
                                :
                                nat))
                             :
                             nat))
                           ((+
                             ((nat2prob
                               ((let (summary
                                      (pair unit (array nat))
                                      ((bucket
                                        ((nat_ 0) : nat)
                                        ((size (w : (array nat))) : nat)
                                        (r_split
                                         (bind
                                          iF
                                          ((==
                                            ((index
                                              (doc : (array nat))
                                              (iF : nat))
                                             :
                                             nat)
                                            (docUpdate : nat))
                                           :
                                           bool))
                                         r_nop
                                         (r_index
                                          ((size
                                            (topic_prior
                                             :
                                             (array prob)))
                                           :
                                           nat)
                                          (bind
                                           iF
                                           ((index
                                             (z : (array nat))
                                             ((index
                                               (doc : (array nat))
                                               (iF : nat))
                                              :
                                              nat))
                                            :
                                            nat))
                                          (r_add
                                           (bind
                                            iF
                                            (bind
                                             i
                                             ((nat_ 1) : nat)))))))
                                       :
                                       (pair unit (array nat))))
                                  ((index
                                    ((match
                                         (summary
                                          :
                                          (pair unit (array nat)))
                                       ((pdatum
                                         pair
                                         (pc_inl
                                          (ps_et
                                           (pf_konst var)
                                           (ps_et
                                            (pf_konst var)
                                            (ps_done)))))
                                        (bind y (bind z z))))
                                     :
                                     (array nat))
                                    (i : nat))
                                   :
                                   nat))
                                :
                                nat))
                              :
                              prob)
                             ((nat2prob (iB : nat)) : prob)
                             ((summate
                               (iF
                                ((nat_ 0) : nat)
                                ((size (word_prior : (array prob)))
                                 :
                                 nat))
                               ((index
                                 (word_prior : (array prob))
                                 (iF : nat))
                                :
                                prob))
                              :
                              prob))
                            :
                            prob))
                          :
                          prob))
                        :
                        prob))
                      :
                      prob))
                    :
                    real))
                  :
                  real))
                :
                prob))
              :
              (array prob)))
            :
            (nat -> (array prob))))
          :
          ((array nat) -> (nat -> (array prob)))))
        :
        ((array nat) -> ((array nat) -> (nat -> (array prob))))))
      :
      ((array nat)
       ->
       ((array nat) -> ((array nat) -> (nat -> (array prob)))))))
    :
    ((array prob)
     ->
     ((array nat)
      ->
      ((array nat) -> ((array nat) -> (nat -> (array prob))))))))
  :
  ((array prob)
   ->
   ((array prob)
    ->
    ((array nat)
     ->
     ((array nat) -> ((array nat) -> (nat -> (array prob))))))))
