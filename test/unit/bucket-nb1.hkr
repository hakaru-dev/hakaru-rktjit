((fn
  topic_prior
  ((array prob)
   ->
   ((array nat) -> ((array nat) -> ((array nat) -> (nat -> (array prob))))))
  ((fn
    word_prior
    ((array nat) -> ((array nat) -> ((array nat) -> (nat -> (array prob)))))
    ((fn
      z
      ((array nat) -> ((array nat) -> (nat -> (array prob))))
      ((fn
        w
        ((array nat) -> (nat -> (array prob)))
        ((fn
          doc
          (nat -> (array prob))
          ((fn
            docUpdate
            (array prob)
            ((match
              ((< (docUpdate : nat) ((size (z : (array nat))) : nat)) : bool)
              ((datum true (pc_inl (ps_done)))
               ((array
                 (zNew ((size (topic_prior : (array prob))) : nat))
                 ((product
                   (i (0 : nat) ((size (topic_prior : (array prob))) : nat))
                   ((product
                     (i_a
                      (0 : nat)
                      ((size (word_prior : (array prob))) : nat))
                     ((product
                       (j
                        (0 : nat)
                        ((let (summary
                               (pair (array (array nat)) unit)
                               ((bucket
                                 (0 : nat)
                                 ((size (w : (array nat))) : nat)
                                 (r_fanout
                                  (r_index
                                   ((size (z : (array nat))) : nat)
                                   (bind
                                    i_b
                                    ((index (doc : (array nat)) (i_b : nat))
                                     :
                                     nat))
                                   (r_index
                                    (bind
                                     docUpdate
                                     ((size (word_prior : (array prob)))
                                      :
                                      nat))
                                    (bind
                                     i_b
                                     (bind
                                      docUpdate
                                      ((index (w : (array nat)) (i_b : nat))
                                       :
                                       nat)))
                                    (r_add
                                     (bind
                                      i_b
                                      (bind
                                       i_a
                                       (bind docUpdate (1 : nat)))))))
                                  r_nop))
                                :
                                (pair (array (array nat)) unit)))
                           ((match
                                ((== (i : nat) (zNew : nat)) : bool)
                              ((datum true (pc_inl (ps_done)))
                               ((index
                                 ((index
                                   ((match
                                        (summary
                                         :
                                         (pair (array (array nat)) unit))
                                      ((datum
                                        pair
                                        (pc_inl
                                         (ps_et
                                          (pf_konst var)
                                          (ps_et (pf_konst var) (ps_done)))))
                                       (bind y (bind z y))))
                                    :
                                    (array (array nat)))
                                   (docUpdate : nat))
                                  :
                                  (array nat))
                                 (i_a : nat))
                                :
                                nat))
                              ((datum false (pc_inr (pc_inl (ps_done))))
                               (0 : nat)))
                            :
                            nat))
                         :
                         nat))
                       ((+
                         ((nat2prob
                           ((let (summary
                                  (pair unit (array (array nat)))
                                  ((bucket
                                    (0 : nat)
                                    ((size (w : (array nat))) : nat)
                                    (r_split
                                     (bind
                                      i_b
                                      ((==
                                        ((index
                                          (doc : (array nat))
                                          (i_b : nat))
                                         :
                                         nat)
                                        (docUpdate : nat))
                                       :
                                       bool))
                                     r_nop
                                     (r_index
                                      ((size (word_prior : (array prob)))
                                       :
                                       nat)
                                      (bind
                                       i_b
                                       ((index (w : (array nat)) (i_b : nat))
                                        :
                                        nat))
                                      (r_index
                                       (bind
                                        i_a
                                        ((size (topic_prior : (array prob)))
                                         :
                                         nat))
                                       (bind
                                        i_b
                                        (bind
                                         i_a
                                         ((index
                                           (z : (array nat))
                                           ((index
                                             (doc : (array nat))
                                             (i_b : nat))
                                            :
                                            nat))
                                          :
                                          nat)))
                                       (r_add
                                        (bind
                                         i_b
                                         (bind i (bind i_a (1 : nat)))))))))
                                   :
                                   (pair unit (array (array nat)))))
                              ((index
                                ((index
                                  ((match
                                       (summary
                                        :
                                        (pair unit (array (array nat))))
                                     ((datum
                                       pair
                                       (pc_inl
                                        (ps_et
                                         (pf_konst var)
                                         (ps_et (pf_konst var) (ps_done)))))
                                      (bind y (bind z z))))
                                   :
                                   (array (array nat)))
                                  (i_a : nat))
                                 :
                                 (array nat))
                                (i : nat))
                               :
                               nat))
                            :
                            nat))
                          :
                          prob)
                         ((nat2prob (j : nat)) : prob)
                         ((index (word_prior : (array prob)) (i_a : nat))
                          :
                          prob))
                        :
                        prob))
                      :
                      prob))
                    :
                    prob))
                  :
                  prob))
                :
                (array prob)))
              ((datum false (pc_inr (pc_inl (ps_done))))
               ((empty) : (array prob))))
             :
             (array prob)))
           :
           (nat -> (array prob))))
         :
         ((array nat) -> (nat -> (array prob)))))
       :
       ((array nat) -> ((array nat) -> (nat -> (array prob))))))
     :
     ((array nat) -> ((array nat) -> ((array nat) -> (nat -> (array prob)))))))
   :
   ((array prob)
    ->
    ((array nat) -> ((array nat) -> ((array nat) -> (nat -> (array prob))))))))
 :
 ((array prob)
  ->
  ((array prob)
   ->
   ((array nat) -> ((array nat) -> ((array nat) -> (nat -> (array prob))))))))
