((fn
   s
   ((array prob) -> ((array nat) -> ((array real) -> (nat -> (measure nat)))))
   ((fn
     as
     ((array nat) -> ((array real) -> (nat -> (measure nat))))
     ((fn
       z
       ((array real) -> (nat -> (measure nat)))
       ((fn
         t
         (nat -> (measure nat))
         ((fn
           docUpdate
           (measure nat)
           ((match
             ((and ((==
                     ((size (z : (array nat))) : nat)
                     ((size (t : (array real))) : nat))
                    :
                    bool)
                   ((< (docUpdate : nat) ((size (z : (array nat))) : nat))
                    :
                    bool)
                   ((<
                     ((index (z : (array nat)) (docUpdate : nat)) : nat)
                     ((size (as : (array prob))) : nat))
                    :
                    bool))
              :
              bool)
             ((pdatum true (pc_inl (ps_done)))
              ((pose
                ((*
                  ((product
                    (_b ((nat_ 0) : nat) ((size (as : (array prob))) : nat))
                    ((product
                      (j
                       ((nat_ 0) : nat)
                       ((let (summary
                              (array nat)
                              ((bucket
                                ((nat_ 0) : nat)
                                ((size (t : (array real))) : nat)
                                (r_index
                                 ((size (as : (array prob))) : nat)
                                 (bind
                                  _a
                                  ((index (z : (array nat)) (_a : nat)) : nat))
                                 (r_add (bind _a (bind _b ((nat_ 1) : nat))))))
                               :
                               (array nat)))
                          ((+
                            ((int2nat
                              ((*
                                ((nat2int
                                  ((match
                                    ((==
                                      (_b : nat)
                                      ((index
                                        (z : (array nat))
                                        (docUpdate : nat))
                                       :
                                       nat))
                                     :
                                     bool)
                                    ((pdatum true (pc_inl (ps_done)))
                                     ((nat_ 1) : nat))
                                    ((pdatum false (pc_inr (pc_inl (ps_done))))
                                     ((nat_ 0) : nat)))
                                   :
                                   nat))
                                 :
                                 int)
                                ((int_ -1) : int))
                               :
                               int))
                             :
                             nat)
                            ((index (summary : (array nat)) (_b : nat)) : nat))
                           :
                           nat))
                        :
                        nat))
                      ((+
                        ((nat2prob (j : nat)) : prob)
                        ((index (as : (array prob)) (_b : nat)) : prob))
                       :
                       prob))
                     :
                     prob))
                   :
                   prob)
                  ((realpow
                    ((prob_ 2 % 1) : prob)
                    ((*
                      ((nat2real ((size (t : (array real))) : nat)) : real)
                      ((real_ (-1) % 2) : real))
                     :
                     real))
                   :
                   prob)
                  ((exp
                    ((*
                      ((summate
                        (_a ((nat_ 0) : nat) ((size (t : (array real))) : nat))
                        ((natpow
                          ((index (t : (array real)) (_a : nat)) : real)
                          ((nat_ 2) : nat))
                         :
                         real))
                       :
                       real)
                      ((real_ (-1) % 2) : real))
                     :
                     real))
                   :
                   prob)
                  ((realpow
                    ((pi) : prob)
                    ((*
                      ((nat2real ((size (t : (array real))) : nat)) : real)
                      ((real_ (-1) % 2) : real))
                     :
                     real))
                   :
                   prob)
                  ((recip
                    ((product
                      (_b
                       ((nat_ 0) : nat)
                       ((summate
                         (_a
                          ((nat_ 0) : nat)
                          ((size (t : (array real))) : nat))
                         ((match
                           ((== (_a : nat) (docUpdate : nat)) : bool)
                           ((pdatum true (pc_inl (ps_done))) ((nat_ 0) : nat))
                           ((pdatum false (pc_inr (pc_inl (ps_done))))
                            ((nat_ 1) : nat)))
                          :
                          nat))
                        :
                        nat))
                      ((+
                        ((nat2prob (_b : nat)) : prob)
                        ((summate
                          (_a
                           ((nat_ 0) : nat)
                           ((size (as : (array prob))) : nat))
                          ((index (as : (array prob)) (_a : nat)) : prob))
                         :
                         prob))
                       :
                       prob))
                     :
                     prob))
                   :
                   prob)
                  ((recip
                    ((+
                      ((nat2prob
                        ((summate
                          (_a
                           ((nat_ 0) : nat)
                           ((size (t : (array real))) : nat))
                          ((match
                            ((== (_a : nat) (docUpdate : nat)) : bool)
                            ((pdatum true (pc_inl (ps_done))) ((nat_ 0) : nat))
                            ((pdatum false (pc_inr (pc_inl (ps_done))))
                             ((nat_ 1) : nat)))
                           :
                           nat))
                         :
                         nat))
                       :
                       prob)
                      ((summate
                        (_a
                         ((nat_ 0) : nat)
                         ((size (as : (array prob))) : nat))
                        ((index (as : (array prob)) (_a : nat)) : prob))
                       :
                       prob))
                     :
                     prob))
                   :
                   prob))
                 :
                 prob)
                ((categorical
                  ((array
                    (zNewd ((size (as : (array prob))) : nat))
                    ((*
                      ((real2prob
                        ((*
                          ((prob2real
                            ((recip
                              ((root
                                ((real2prob
                                  ((product
                                    (_b
                                     ((nat_ 0) : nat)
                                     ((size (as : (array prob))) : nat))
                                    ((+
                                      ((*
                                        ((int2real
                                          ((let (summary
                                                 (array nat)
                                                 ((bucket
                                                   ((nat_ 0) : nat)
                                                   ((size (t : (array real)))
                                                    :
                                                    nat)
                                                   (r_index
                                                    ((size (as : (array prob)))
                                                     :
                                                     nat)
                                                    (bind
                                                     _a
                                                     ((index
                                                       (z : (array nat))
                                                       (_a : nat))
                                                      :
                                                      nat))
                                                    (r_add
                                                     (bind
                                                      _a
                                                      (bind
                                                       _b
                                                       ((nat_ 1) : nat))))))
                                                  :
                                                  (array nat)))
                                             ((+
                                               ((nat2int
                                                 ((match
                                                   ((==
                                                     (_b : nat)
                                                     (zNewd : nat))
                                                    :
                                                    bool)
                                                   ((pdatum
                                                     true
                                                     (pc_inl (ps_done)))
                                                    ((nat_ 1) : nat))
                                                   ((pdatum
                                                     false
                                                     (pc_inr
                                                      (pc_inl (ps_done))))
                                                    ((nat_ 0) : nat)))
                                                  :
                                                  nat))
                                                :
                                                int)
                                               ((*
                                                 ((nat2int
                                                   ((match
                                                     ((==
                                                       (_b : nat)
                                                       ((index
                                                         (z : (array nat))
                                                         (docUpdate : nat))
                                                        :
                                                        nat))
                                                      :
                                                      bool)
                                                     ((pdatum
                                                       true
                                                       (pc_inl (ps_done)))
                                                      ((nat_ 1) : nat))
                                                     ((pdatum
                                                       false
                                                       (pc_inr
                                                        (pc_inl (ps_done))))
                                                      ((nat_ 0) : nat)))
                                                    :
                                                    nat))
                                                  :
                                                  int)
                                                 ((int_ -1) : int))
                                                :
                                                int)
                                               ((nat2int
                                                 ((index
                                                   (summary : (array nat))
                                                   (_b : nat))
                                                  :
                                                  nat))
                                                :
                                                int))
                                              :
                                              int))
                                           :
                                           int))
                                         :
                                         real)
                                        ((prob2real
                                          ((natpow (s : prob) ((nat_ 2) : nat))
                                           :
                                           prob))
                                         :
                                         real))
                                       :
                                       real)
                                      ((real_ 1 % 1) : real))
                                     :
                                     real))
                                   :
                                   real))
                                 :
                                 prob)
                                ((nat_ 2) : nat))
                               :
                               prob))
                             :
                             prob))
                           :
                           real)
                          ((+
                            ((int2real
                              ((let (summary
                                     (array nat)
                                     ((bucket
                                       ((nat_ 0) : nat)
                                       ((size (t : (array real))) : nat)
                                       (r_index
                                        ((size (as : (array prob))) : nat)
                                        (bind
                                         _a
                                         ((index (z : (array nat)) (_a : nat))
                                          :
                                          nat))
                                        (r_add
                                         (bind
                                          _a
                                          (bind zNewd ((nat_ 1) : nat))))))
                                      :
                                      (array nat)))
                                 ((+
                                   ((*
                                     ((nat2int
                                       ((match
                                         ((==
                                           (zNewd : nat)
                                           ((index
                                             (z : (array nat))
                                             (docUpdate : nat))
                                            :
                                            nat))
                                          :
                                          bool)
                                         ((pdatum true (pc_inl (ps_done)))
                                          ((nat_ 1) : nat))
                                         ((pdatum
                                           false
                                           (pc_inr (pc_inl (ps_done))))
                                          ((nat_ 0) : nat)))
                                        :
                                        nat))
                                      :
                                      int)
                                     ((int_ -1) : int))
                                    :
                                    int)
                                   ((nat2int
                                     ((index
                                       (summary : (array nat))
                                       (zNewd : nat))
                                      :
                                      nat))
                                    :
                                    int))
                                  :
                                  int))
                               :
                               int))
                             :
                             real)
                            ((prob2real
                              ((index (as : (array prob)) (zNewd : nat))
                               :
                               prob))
                             :
                             real))
                           :
                           real))
                         :
                         real))
                       :
                       prob)
                      ((exp
                        ((*
                          ((summate
                            (_a
                             ((nat_ 0) : nat)
                             ((size (as : (array prob))) : nat))
                            ((*
                              ((natpow
                                ((let (summary
                                       (array real)
                                       ((bucket
                                         ((nat_ 0) : nat)
                                         ((size (t : (array real))) : nat)
                                         (r_index
                                          ((size (as : (array prob))) : nat)
                                          (bind
                                           i
                                           ((index (z : (array nat)) (i : nat))
                                            :
                                            nat))
                                          (r_add
                                           (bind
                                            i
                                            (bind
                                             _a
                                             ((index
                                               (t : (array real))
                                               (i : nat))
                                              :
                                              real))))))
                                        :
                                        (array real)))
                                   ((+
                                     ((match
                                       ((== (_a : nat) (zNewd : nat)) : bool)
                                       ((pdatum true (pc_inl (ps_done)))
                                        ((index
                                          (t : (array real))
                                          (docUpdate : nat))
                                         :
                                         real))
                                       ((pdatum
                                         false
                                         (pc_inr (pc_inl (ps_done))))
                                        ((real_ 0 % 1) : real)))
                                      :
                                      real)
                                     ((*
                                       ((match
                                         ((==
                                           (_a : nat)
                                           ((index
                                             (z : (array nat))
                                             (docUpdate : nat))
                                            :
                                            nat))
                                          :
                                          bool)
                                         ((pdatum true (pc_inl (ps_done)))
                                          ((index
                                            (t : (array real))
                                            (docUpdate : nat))
                                           :
                                           real))
                                         ((pdatum
                                           false
                                           (pc_inr (pc_inl (ps_done))))
                                          ((real_ 0 % 1) : real)))
                                        :
                                        real)
                                       ((real_ (-1) % 1) : real))
                                      :
                                      real)
                                     ((index
                                       (summary : (array real))
                                       (_a : nat))
                                      :
                                      real))
                                    :
                                    real))
                                 :
                                 real)
                                ((nat_ 2) : nat))
                               :
                               real)
                              ((recip
                                ((+
                                  ((*
                                    ((int2real
                                      ((let (summary
                                             (array nat)
                                             ((bucket
                                               ((nat_ 0) : nat)
                                               ((size (t : (array real)))
                                                :
                                                nat)
                                               (r_index
                                                ((size (as : (array prob)))
                                                 :
                                                 nat)
                                                (bind
                                                 i
                                                 ((index
                                                   (z : (array nat))
                                                   (i : nat))
                                                  :
                                                  nat))
                                                (r_add
                                                 (bind
                                                  i
                                                  (bind
                                                   _a
                                                   ((nat_ 1) : nat))))))
                                              :
                                              (array nat)))
                                         ((+
                                           ((nat2int
                                             ((match
                                               ((== (_a : nat) (zNewd : nat))
                                                :
                                                bool)
                                               ((pdatum
                                                 true
                                                 (pc_inl (ps_done)))
                                                ((nat_ 1) : nat))
                                               ((pdatum
                                                 false
                                                 (pc_inr (pc_inl (ps_done))))
                                                ((nat_ 0) : nat)))
                                              :
                                              nat))
                                            :
                                            int)
                                           ((*
                                             ((nat2int
                                               ((match
                                                 ((==
                                                   (_a : nat)
                                                   ((index
                                                     (z : (array nat))
                                                     (docUpdate : nat))
                                                    :
                                                    nat))
                                                  :
                                                  bool)
                                                 ((pdatum
                                                   true
                                                   (pc_inl (ps_done)))
                                                  ((nat_ 1) : nat))
                                                 ((pdatum
                                                   false
                                                   (pc_inr (pc_inl (ps_done))))
                                                  ((nat_ 0) : nat)))
                                                :
                                                nat))
                                              :
                                              int)
                                             ((int_ -1) : int))
                                            :
                                            int)
                                           ((nat2int
                                             ((index
                                               (summary : (array nat))
                                               (_a : nat))
                                              :
                                              nat))
                                            :
                                            int))
                                          :
                                          int))
                                       :
                                       int))
                                     :
                                     real)
                                    ((prob2real
                                      ((natpow (s : prob) ((nat_ 2) : nat))
                                       :
                                       prob))
                                     :
                                     real))
                                   :
                                   real)
                                  ((real_ 1 % 1) : real))
                                 :
                                 real))
                               :
                               real))
                             :
                             real))
                           :
                           real)
                          ((prob2real
                            ((natpow (s : prob) ((nat_ 2) : nat)) : prob))
                           :
                           real)
                          ((real_ 1 % 2) : real))
                         :
                         real))
                       :
                       prob))
                     :
                     prob))
                   :
                   (array prob)))
                 :
                 (measure nat)))
               :
               (measure nat)))
             ((pdatum false (pc_inr (pc_inl (ps_done))))
              ((match
                ((not
                  ((==
                    ((size (z : (array nat))) : nat)
                    ((size (t : (array real))) : nat))
                   :
                   bool))
                 :
                 bool)
                ((pdatum true (pc_inl (ps_done))) ((reject) : (measure nat)))
                ((pdatum false (pc_inr (pc_inl (ps_done))))
                 ((match
                   ((not
                     ((< (docUpdate : nat) ((size (z : (array nat))) : nat))
                      :
                      bool))
                    :
                    bool)
                   ((pdatum true (pc_inl (ps_done)))
                    ((reject) : (measure nat)))
                   ((pdatum false (pc_inr (pc_inl (ps_done))))
                    ((reject) : (measure nat))))
                  :
                  (measure nat))))
               :
               (measure nat))))
            :
            (measure nat)))
          :
          (nat -> (measure nat))))
        :
        ((array real) -> (nat -> (measure nat)))))
      :
      ((array nat) -> ((array real) -> (nat -> (measure nat))))))
    :
    ((array prob)
     ->
     ((array nat) -> ((array real) -> (nat -> (measure nat)))))))
  :
  (prob
   ->
   ((array prob)
    ->
    ((array nat) -> ((array real) -> (nat -> (measure nat)))))))
